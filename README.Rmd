---
title: PBADownloader 0.1.0
date: "`r Sys.Date()`"
subtitle: Tool to download PBA of Galicia by a list of municipalities, as spatial ready information.
tags: [R,Catastro,Patrimonio, sf, mapview, html, maps, zip]
output: github_document
always_allow_html: yes
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  out.width = "100%"
)
```

---

# Description


# Installation

This packages has been tested in:

  - Ubuntu 20.04 with R 4.0.3
  - Windows 10 with R 4.0 + Rtools40

Install dependencies (libraries) in R:

```{r eval = FALSE, echo=TRUE}
# install libraries to install packages from github
install.packages("devtools"); library(devtools)

install_github("cesarkero/PBADownloader")
```

# Before try out

Please, use this library using your brain. Download just what you need and avoid constant masive downloads
as it will produce overload in public servers and this can lead to restrictions for the general public. So please, be kind with the service and let us all enjoy this data. For sure, don't try parallel for masive downloads until you have checked that this is a useful tool to you.

Moreover, if you just need the layers for a single or a few municipalities, just use the web [Plan B치sico Auton칩mico](http://mapas.xunta.gal/visores/descargas-pba/).

[![Plan B치sico Auton칩mico](./man/figures/I00.png)](http://mapas.xunta.gal/visores/descargas-pba/)

Enjoy.

---

# Examples

## Single Province download
The library already contains the data with the names and composed urls. Just load it and show it to get the name of the desired municipality. It works also with a list of municipalities.
Be patient as the function contains an sleep of 60s between executions in order to avoid crushing server.

```{r eval = FALSE, echo=TRUE}
#-------------------------------------------------------------------------------
# PARAMETERS
# read data
data("pbaurls")
outdir <- '../02_OUTPUT/'

# show municipalities available
pbaurls$Concello

#-----------------------------------------------------------------------
# Single execution
PBADownloader("Beade", outdir)

# Single execution in a serie of municipalities (on by one)
concellos <- c("Paderne", "Pol","A Peroxa", "Sarria",
               "Taboada", "Parada De Sil", "Vedra")
lapply(concellos, PBADownloader, outdir)

# Download all
concellos <- pbaurls$Concello
lapply(concellos, PBADownloader, outdir)
```


```{r echo = FALSE, fig.cap="Screenshots of generated files (.gpkg) for several excutions", out.width = '100%', fig.align="center"}
knitr::include_graphics("./man/figures/I00.png")
```

## Parallel process for several municipalities

```{r eval = FALSE, echo=TRUE}
# execute in parallel
pbaurls$Concello # show municipalities available
concellos <- c("Paderne", "Pol","A Peroxa", "Sarria")
parPBADownloader(concellos, outdir, ncores = 5)

# DOWNLOAD ALL IN PARALLEL  (BE CAREFUL...)
concellos <- pbaurls$Concello
parPBADownloader(concellos, outdir, ncores = 6)
```

```{r echo = FALSE, fig.cap="Some example of buildingparts", out.width = '100%', fig.align="center"}
knitr::include_graphics("./man/figures/I00.png")
```

## PBAmixer: this allows the user to condense all the downloaded layers into a single file

```{r eval = FALSE, echo=TRUE}
#' outdir <- '../02_OUTPUT/'
#' PBAmixer(outdir)
```

```{r echo = FALSE, fig.cap="Some example of buildingparts", out.width = '100%', fig.align="center"}
knitr::include_graphics("./man/figures/I00.png")
```

## Screenshots of the results

<p align="center">
  <img width="300" src="./man/figures/I00.png">
</p>

#### Screenshot of Ceuta
<p align="center">
  <img width="800" src="./man/figures/I00.png">
</p>

#### Detail of Ceuta
<p align="center">
  <img width="800" src="./man/figures/I00.png">
</p>

#### Screenshot of Orense (somewhere)
<p align="center">
  <img width="800" src="./man/figures/I00.png">
</p>

# Notes for the future:

---
# Corrections:
 - It could be interesting to mix the layers into a single layer by categorie.
